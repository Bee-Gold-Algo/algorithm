name: PR Branch - README Update (Only PR Branch)
on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches: [main, master]
  workflow_dispatch:
    inputs:
      pr_number:
        description: 'PR ë²ˆí˜¸'
        required: false
        type: string
      force_update:
        description: 'ê°•ì œ ì—…ë°ì´íŠ¸'
        required: false
        default: true
        type: boolean
      notification:
        description: 'ì•Œë¦¼ ì „ì†¡ ì—¬ë¶€'
        required: false
        default: false
        type: boolean

permissions:
  contents: write
  pull-requests: write
  issues: write
  actions: read

env:
  TZ: Asia/Seoul
  DEBUG_MODE: true

jobs:
  update-pr-branch-readme:
    runs-on: ubuntu-latest
    steps:
      - name: PR Branch README Update Info
        run: |
          echo "ðŸ”¥ PR ë¸Œëžœì¹˜ README ì—…ë°ì´íŠ¸ (main ë¸Œëžœì¹˜ ê±´ë“œë¦¬ì§€ ì•ŠìŒ)"
          echo "â° ì‹¤í–‰ ì‹œê°„: $(date '+%Y-%m-%d %H:%M:%S KST')"
          echo "ðŸ”§ íŠ¸ë¦¬ê±°: ${{ github.event_name }}"
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            echo "ðŸ“ PR ë²ˆí˜¸: #${{ github.event.number }}"
            echo "ðŸ‘¤ PR ìž‘ì„±ìž: ${{ github.event.pull_request.user.login }}"
            echo "ðŸŒ¿ PR ë¸Œëžœì¹˜: ${{ github.event.pull_request.head.ref }}"
            echo "ðŸ“„ PR ì œëª©: ${{ github.event.pull_request.title }}"
            echo "ðŸŽ¯ ê¸°ë³¸ ë¸Œëžœì¹˜: ${{ github.event.pull_request.base.ref }}"
          fi
          echo "ðŸ‘¤ ì‹¤í–‰ìž: ${{ github.actor }}"
          
      - name: Checkout PR branch (NOT main!)
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0
          # PRì˜ head ë¸Œëžœì¹˜ë¡œ ì²´í¬ì•„ì›ƒ (main ì•„ë‹˜!)
          ref: ${{ github.event_name == 'pull_request' && github.event.pull_request.head.ref || 'main' }}
          
      - name: Verify we're on PR branch
        run: |
          CURRENT_BRANCH=$(git branch --show-current)
          echo "ðŸ“ í˜„ìž¬ ë¸Œëžœì¹˜: $CURRENT_BRANCH"
          
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            EXPECTED_BRANCH="${{ github.event.pull_request.head.ref }}"
            echo "ðŸ“ ì˜ˆìƒ ë¸Œëžœì¹˜: $EXPECTED_BRANCH"
            
            if [ "$CURRENT_BRANCH" != "$EXPECTED_BRANCH" ]; then
              echo "âŒ ë¸Œëžœì¹˜ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!"
              echo "   í˜„ìž¬: $CURRENT_BRANCH"
              echo "   ì˜ˆìƒ: $EXPECTED_BRANCH"
              exit 1
            else
              echo "âœ… PR ë¸Œëžœì¹˜ í™•ì¸ ì™„ë£Œ: $CURRENT_BRANCH"
            fi
          fi
          
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"
          
      - name: Install dependencies
        run: |
          pip install requests pytz
          echo "ðŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ë£Œ"
          
      - name: Check latest submissions (from main branch)
        run: |
          echo "ðŸ“‚ ìµœì‹  ì œì¶œ í˜„í™© ê°€ì ¸ì˜¤ê¸° (main ë¸Œëžœì¹˜ì—ì„œ)..."
          
          # main ë¸Œëžœì¹˜ì˜ ìµœì‹  ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
          git fetch origin main
          
          echo "ðŸ” main ë¸Œëžœì¹˜ì˜ ì‚¬ìš©ìž ë””ë ‰í† ë¦¬ ìŠ¤ìº”:"
          git show main: | head -20 || echo "main ë¸Œëžœì¹˜ ì •ë³´ í™•ì¸ ì¤‘..."
          
          # main ë¸Œëžœì¹˜ì˜ íŒŒì¼ ëª©ë¡ í™•ì¸
          echo "ðŸ“ main ë¸Œëžœì¹˜ íŒŒì¼ êµ¬ì¡°:"
          git ls-tree -r --name-only main | grep -E "^[^./]+/[0-9]+/.*\.java$" | head -20 || echo "Java íŒŒì¼ ì—†ìŒ"
          
      - name: Get current session info
        run: |
          echo "ðŸ” í˜„ìž¬ íšŒì°¨ ì •ë³´ ì„¤ì •..."
          
          # ì‹¤ì œ í˜„ìž¬ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ íšŒì°¨ ê³„ì‚°
          TODAY=$(date '+%Y-%m-%d')
          
          # 2025-07-21ì„ 1íšŒì°¨ ì‹œìž‘ìœ¼ë¡œ ê°€ì •
          START_DATE="2025-07-21"
          START_TIMESTAMP=$(date -d "$START_DATE" +%s)
          TODAY_TIMESTAMP=$(date -d "$TODAY" +%s)
          
          DAYS_DIFF=$(( (TODAY_TIMESTAMP - START_TIMESTAMP) / 86400 ))
          WEEK_NUMBER=$(( DAYS_DIFF / 7 + 1 ))
          
          if [ $WEEK_NUMBER -lt 1 ]; then
            WEEK_NUMBER=1
          fi
          
          # ì´ë²ˆ ì£¼ ì›”ìš”ì¼ê³¼ ì¼ìš”ì¼ ê³„ì‚°
          DAYS_SINCE_MONDAY=$(date +%u)
          DAYS_SINCE_MONDAY=$((DAYS_SINCE_MONDAY - 1))
          
          WEEK_START=$(date -d "$TODAY - ${DAYS_SINCE_MONDAY} days" '+%Y-%m-%d')
          WEEK_END=$(date -d "$WEEK_START + 6 days" '+%Y-%m-%d')
          DEADLINE="$WEEK_END 23:59"
          
          echo "SESSION_NUMBER=$WEEK_NUMBER" >> $GITHUB_ENV
          echo "TODAY=$TODAY" >> $GITHUB_ENV
          echo "WEEK_START=$WEEK_START" >> $GITHUB_ENV
          echo "WEEK_END=$WEEK_END" >> $GITHUB_ENV
          echo "DEADLINE=$DEADLINE" >> $GITHUB_ENV
          
          echo "ðŸ“Š ê³„ì‚°ëœ íšŒì°¨ ì •ë³´:"
          echo "   - íšŒì°¨: ${WEEK_NUMBER}íšŒì°¨"
          echo "   - ê¸°ê°„: $WEEK_START ~ $WEEK_END"
          echo "   - ë§ˆê°: $DEADLINE"
          echo "   - ì˜¤ëŠ˜: $TODAY"
          
      - name: Scan actual submissions from main branch
        run: |
          echo "ðŸ“‚ main ë¸Œëžœì¹˜ì—ì„œ ì‹¤ì œ ì œì¶œ í˜„í™© ìŠ¤ìº” ì¤‘..."
          
          # main ë¸Œëžœì¹˜ì˜ ì‚¬ìš©ìž ì œì¶œ í˜„í™©ì„ JSON í˜•íƒœë¡œ ì €ìž¥
          echo "{" > submissions.json
          
          FIRST_USER=true
          
          # main ë¸Œëžœì¹˜ì˜ ëª¨ë“  Java íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
          git ls-tree -r --name-only main | grep -E "^[^./]+/[0-9]+/.*\.java$" | while read file; do
            # ê²½ë¡œ ë¶„ì„: user/problem/file.java
            USER=$(echo "$file" | cut -d'/' -f1)
            PROBLEM=$(echo "$file" | cut -d'/' -f2)
            
            echo "   âœ… $USER/$PROBLEM"
          done | sort | uniq > temp_submissions.txt
          
          # ì‚¬ìš©ìžë³„ë¡œ ê·¸ë£¹í™”
          USERS=$(cat temp_submissions.txt | cut -d'/' -f1 | sort | uniq)
          
          echo "ðŸ“Š ë°œê²¬ëœ ì‚¬ìš©ìžë“¤:"
          for USER in $USERS; do
            PROBLEMS=$(cat temp_submissions.txt | grep "^$USER/" | cut -d'/' -f2 | sort -n | tr '\n' ',' | sed 's/,$//')
            PROBLEM_COUNT=$(echo "$PROBLEMS" | tr ',' '\n' | wc -l)
            echo "   - $USER: $PROBLEM_COUNTê°œ ë¬¸ì œ ($PROBLEMS)"
            
            # í™˜ê²½ë³€ìˆ˜ë¡œ ì €ìž¥ (ë‚˜ì¤‘ì— README ìƒì„±í•  ë•Œ ì‚¬ìš©)
            echo "USER_${USER}_PROBLEMS=$PROBLEMS" >> $GITHUB_ENV
          done
          
          echo "ALL_USERS=$USERS" >> $GITHUB_ENV
          
          rm -f temp_submissions.txt
          
      - name: Create updated README with latest submissions
        run: |
          echo "ðŸ“ ìµœì‹  ì œì¶œ í˜„í™©ìœ¼ë¡œ README ìƒì„± ì¤‘..."
          
          # ì£¼ê°„ ë‚ ì§œ ê³„ì‚°
          WEEK_START_DATE=$(date -d "$WEEK_START" '+%Y-%m-%d')
          MONDAY=$(date -d "$WEEK_START_DATE" '+%m/%d')
          TUESDAY=$(date -d "$WEEK_START_DATE + 1 day" '+%m/%d')
          WEDNESDAY=$(date -d "$WEEK_START_DATE + 2 days" '+%m/%d')
          THURSDAY=$(date -d "$WEEK_START_DATE + 3 days" '+%m/%d')
          FRIDAY=$(date -d "$WEEK_START_DATE + 4 days" '+%m/%d')
          SATURDAY=$(date -d "$WEEK_START_DATE + 5 days" '+%m/%d')
          SUNDAY=$(date -d "$WEEK_START_DATE + 6 days" '+%m/%d')
          
          # README ìƒì„± ì‹œìž‘
          cat > README.md << EOF
          # ðŸš€ ì•Œê³ ë¦¬ì¦˜ ìŠ¤í„°ë””

          ## ðŸ“… ${SESSION_NUMBER}íšŒì°¨ í˜„í™©
          **ê¸°ê°„**: ${WEEK_START} ~ ${WEEK_END}

          **ë§ˆê°**: ${DEADLINE}

          ### ì œì¶œ í˜„í™©

          | ì°¸ê°€ìž | ì›” | í™” | ìˆ˜ | ëª© | ê¸ˆ | í†  | ì¼ |
          |--------|----|----|----|----|----|----|---|
          |        | ${MONDAY} | ${TUESDAY} | ${WEDNESDAY} | ${THURSDAY} | ${FRIDAY} | ${SATURDAY} | ${SUNDAY} |
          EOF
          
          # ì‹¤ì œ ì‚¬ìš©ìž ë°ì´í„° ì¶”ê°€
          if [ -n "$ALL_USERS" ]; then
            for USER in $ALL_USERS; do
              PROBLEMS_VAR="USER_${USER}_PROBLEMS"
              PROBLEMS=${!PROBLEMS_VAR}
              
              if [ -n "$PROBLEMS" ]; then
                # ë¬¸ì œë“¤ì„ ìš”ì¼ë³„ë¡œ ë¶„ë°° (ê°„ë‹¨ížˆ í† ìš”ì¼ì— ëª¨ë‘ í‘œì‹œ)
                PROBLEM_LIST=$(echo "$PROBLEMS" | sed 's/,/, /g')
                
                # ë¬¸ì œê°€ 3ê°œ ì´ìƒì´ë©´ ...ìœ¼ë¡œ ì¶•ì•½
                PROBLEM_COUNT=$(echo "$PROBLEMS" | tr ',' '\n' | wc -l)
                if [ $PROBLEM_COUNT -gt 3 ]; then
                  FIRST_THREE=$(echo "$PROBLEMS" | cut -d',' -f1-3 | sed 's/,/, /g')
                  PROBLEM_LIST="${FIRST_THREE}..."
                fi
                
                echo "| ${USER} |  |  |  |  |  | ${PROBLEM_LIST} |  |" >> README.md
                echo "   âœ… $USER ì¶”ê°€: $PROBLEM_COUNTê°œ ë¬¸ì œ"
              fi
            done
          else
            echo "| ì•„ì§_ì œì¶œì—†ìŒ |  |  |  |  |  |  |  |" >> README.md
          fi
          
          # README ë‚˜ë¨¸ì§€ ë¶€ë¶„ ì¶”ê°€
          cat >> README.md << 'EOF'

          ## ðŸ¤– ìžë™í™” ì‹œìŠ¤í…œ ì†Œê°œ

          ### ðŸ”§ ì£¼ìš” ê¸°ëŠ¥
          - **ìžë™ í…ŒìŠ¤íŠ¸**: ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ + AI ìƒì„± ë°˜ë¡€ í…ŒìŠ¤íŠ¸
          - **ìŠ¤ë§ˆíŠ¸ ì±„ì **: ë¶€ë¶„ ì ìˆ˜ ì§€ì› (ìƒ˜í”Œë§Œ/ìƒì„± í…ŒìŠ¤íŠ¸ë§Œ í†µê³¼)
          - **ê°œì¸ ì•Œë¦¼**: Mattermost ê°œì¸ DMìœ¼ë¡œ ê²°ê³¼ ì•Œë¦¼
          - **ìžë™ README ì—…ë°ì´íŠ¸**: ì œì¶œ í˜„í™© ì‹¤ì‹œê°„ ë°˜ì˜

          ### ðŸ§  ì‚¬ìš© ê¸°ìˆ 
          - **AI ëª¨ë¸**: Google Gemini 2.5-flash
          - **í…ŒìŠ¤íŠ¸ ìƒì„±**: ë¬¸ì œ ë¶„ì„ â†’ ë°˜ë¡€ ìžë™ ìƒì„±
          - **í”Œëž«í¼**: GitHub Actions + Python
          - **ê°œì¸ ì•Œë¦¼**: ì‚¬ìš©ìžë³„ ì£¼ê°„ í˜„í™© ì²´í¬ + ë§žì¶¤ ì•Œë¦¼

          ### ðŸ“ ì‚¬ìš© ë°©ë²•

          #### 1. Repository ì„¤ì •
          ```bash
          # 1. ì´ Repository Fork
          # 2. ë³¸ì¸ ë””ë ‰í† ë¦¬ ìƒì„±: ë³¸ì¸ê¹ƒí—ˆë¸Œì•„ì´ë””/ë¬¸ì œë²ˆí˜¸/Main.java
          # 3. ì½”ë“œ ìž‘ì„± í›„ PR ìƒì„±
          ```

          #### 2. í•„ìš”í•œ Secrets ì„¤ì •
          Repository Settings â†’ Secrets and variables â†’ Actionsì—ì„œ ë‹¤ìŒ ì„¤ì •:

          ```
          GEMINI_API_KEY=your_gemini_api_key
          MATTERMOST_WEBHOOK_URL=your_default_channel_webhook  # ê¸°ë³¸ ì±„ë„ìš©
          ë³¸ì¸ê¹ƒí—ˆë¸Œì•„ì´ë””_MATTERMOST_URL=your_personal_webhook  # ê°œì¸ DMìš© (í•„ìˆ˜)
          ```

          **ðŸ“± ê°œì¸ ì•Œë¦¼ ì„¤ì •**: ì£¼ê°„ 5ë¬¸ì œ ë¯¸ë‹¬ ì‹œ ê°œì¸ DM ì•Œë¦¼ì„ ë°›ìœ¼ë ¤ë©´ ë°˜ë“œì‹œ ê°œì¸ webhook URLì„ ì„¤ì •í•˜ì„¸ìš”. 
          ìžì„¸í•œ ì„¤ì • ë°©ë²•ì€ `docs/ê°œì¸ì•Œë¦¼_ì„¤ì •ê°€ì´ë“œ.md`ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

          #### 3. ë””ë ‰í† ë¦¬ êµ¬ì¡°
          ```
          ë³¸ì¸ê¹ƒí—ˆë¸Œì•„ì´ë””/
          â”œâ”€â”€ 1000/
          â”‚   â””â”€â”€ Main.java
          â”œâ”€â”€ 1001/
          â”‚   â””â”€â”€ Main.java
          â””â”€â”€ 2557/
              â””â”€â”€ Main.java
          ```

          #### 4. PR ì œì¶œ ê³¼ì •
          1. **ë¸Œëžœì¹˜ ìƒì„±**: `git checkout -b week-N-solutions`  
          2. **ì½”ë“œ ìž‘ì„±**: ìœ„ êµ¬ì¡°ëŒ€ë¡œ íŒŒì¼ ë°°ì¹˜
          3. **PR ìƒì„±**: main ë¸Œëžœì¹˜ë¡œ Pull Request
          4. **ìžë™ í…ŒìŠ¤íŠ¸**: GitHub Actionsì—ì„œ ìžë™ ì‹¤í–‰
          5. **ê²°ê³¼ í™•ì¸**: ê°œì¸ DM + PR ëŒ“ê¸€ë¡œ ê²°ê³¼ ì•Œë¦¼
          6. **ìžë™ ë³‘í•©**: í…ŒìŠ¤íŠ¸ í†µê³¼ ì‹œ ìžë™ README ì—…ë°ì´íŠ¸ í›„ ë³‘í•©

          ### ðŸŽ¯ í…ŒìŠ¤íŠ¸ ê¸°ì¤€
          - **ì™„ì „ ì„±ê³µ**: ìƒ˜í”Œ + ìƒì„± í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼
          - **ë¶€ë¶„ ì„±ê³µ**: ìƒ˜í”Œ ë˜ëŠ” ìƒì„± í…ŒìŠ¤íŠ¸ ì¤‘ í•˜ë‚˜ë§Œ í†µê³¼  
          - **ì‹¤íŒ¨**: ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨
          - **PR ìŠ¹ì¸**: í•œ ë¬¸ì œ ì´ìƒ ì„±ê³µ ì‹œ ìžë™ ìŠ¹ì¸

          ### ðŸš¨ ì£¼ì˜ì‚¬í•­
          - Java 11 í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ë©ë‹ˆë‹¤
          - íŒŒì¼ëª…ì€ ë°˜ë“œì‹œ `Main.java`ë¡œ í†µì¼
          - íŒ¨í‚¤ì§€ ì„ ì–¸ ì—†ì´ ìž‘ì„±í•´ì£¼ì„¸ìš”
          - ë¬´í•œë£¨í”„ë‚˜ ê³¼ë„í•œ ë©”ëª¨ë¦¬ ì‚¬ìš© ì‹œ íƒ€ìž„ì•„ì›ƒë©ë‹ˆë‹¤

          ### ðŸ“ž ë¬¸ì˜ì‚¬í•­
          - GitHub Issues ë˜ëŠ” Mattermost ì±„ë„ì—ì„œ ë¬¸ì˜
          - ë²„ê·¸ ë¦¬í¬íŠ¸ë‚˜ ê°œì„  ì œì•ˆ í™˜ì˜í•©ë‹ˆë‹¤!

          ---
          *Auto-updated by GitHub Actions ðŸ¤– (PR ë¸Œëžœì¹˜ì—ì„œ main ë¸Œëžœì¹˜ ë°ì´í„° ë°˜ì˜)*
          EOF
          
          echo "âœ… ìµœì‹  ì œì¶œ í˜„í™©ì´ ë°˜ì˜ëœ README ìƒì„± ì™„ë£Œ"
          
      - name: Show updated README preview
        run: |
          echo "ðŸ“„ ì—…ë°ì´íŠ¸ëœ README.md ë¯¸ë¦¬ë³´ê¸°:"
          echo "================================================"
          head -30 README.md
          echo "================================================"
          echo "(ì´ $(wc -l < README.md) ì¤„)"
          
          echo ""
          echo "ðŸ“Š ë°˜ì˜ëœ ì œì¶œ í˜„í™©:"
          if [ -n "$ALL_USERS" ]; then
            for USER in $ALL_USERS; do
              PROBLEMS_VAR="USER_${USER}_PROBLEMS"
              PROBLEMS=${!PROBLEMS_VAR}
              PROBLEM_COUNT=$(echo "$PROBLEMS" | tr ',' '\n' | wc -l)
              echo "   - $USER: $PROBLEM_COUNTê°œ ë¬¸ì œ"
            done
          else
            echo "   - ì œì¶œëœ ë¬¸ì œ ì—†ìŒ"
          fi
          
      - name: Commit README changes to PR branch
        run: |
          echo "ðŸ’¾ PR ë¸Œëžœì¹˜ì— README ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ì¤‘..."
          
          CURRENT_BRANCH=$(git branch --show-current)
          echo "ðŸ“ ì»¤ë°‹í•  ë¸Œëžœì¹˜: $CURRENT_BRANCH"
          
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action - PR README Update"
          
          # ë³€ê²½ì‚¬í•­ í™•ì¸
          if git diff --quiet README.md; then
            echo "ðŸ“ README ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
            echo "CHANGES_COMMITTED=false" >> $GITHUB_ENV
          else
            echo "ðŸ“ README ë³€ê²½ì‚¬í•­ ë°œê²¬, ì»¤ë°‹ ì¤‘..."
            
            git add README.md
            
            COMMIT_TIME=$(date '+%Y-%m-%d %H:%M:%S KST')
            USER_COUNT=$(echo "$ALL_USERS" | wc -w)
            
            git commit -m "ðŸ“ README ìžë™ ì—…ë°ì´íŠ¸ - ${SESSION_NUMBER}íšŒì°¨ ìµœì‹  ì œì¶œ í˜„í™© ë°˜ì˜

            ðŸ“… ê¸°ê°„: ${WEEK_START} ~ ${WEEK_END}
            â° ë§ˆê°: ${DEADLINE}
            ðŸ‘¥ ì°¸ê°€ìž: ${USER_COUNT}ëª…
            ðŸ”§ íŠ¸ë¦¬ê±°: ${{ github.event_name }}
            ðŸŒ¿ ë¸Œëžœì¹˜: $CURRENT_BRANCH
            ðŸ• ì—…ë°ì´íŠ¸: $COMMIT_TIME

            âœ¨ main ë¸Œëžœì¹˜ì˜ ìµœì‹  ì œì¶œ í˜„í™©ì„ ìŠ¤ìº”í•˜ì—¬ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤."
                        
                        git push origin "$CURRENT_BRANCH"
                        
                        echo "âœ… PR ë¸Œëžœì¹˜ì— README ì—…ë°ì´íŠ¸ ì»¤ë°‹ ì™„ë£Œ!"
                        echo "CHANGES_COMMITTED=true" >> $GITHUB_ENV
                      fi
          
      - name: Add PR comment with update results
        if: github.event_name == 'pull_request' && env.CHANGES_COMMITTED == 'true'
        continue-on-error: true
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const prNumber = context.payload.number;
            const sessionNumber = process.env.SESSION_NUMBER;
            const weekStart = process.env.WEEK_START;
            const weekEnd = process.env.WEEK_END;
            const deadline = process.env.DEADLINE;
            const allUsers = process.env.ALL_USERS;
            const userCount = allUsers ? allUsers.split(' ').length : 0;
            
            let userList = '';
            if (allUsers) {
              const users = allUsers.split(' ');
              for (const user of users) {
                const problemsVar = `USER_${user}_PROBLEMS`;
                const problems = process.env[problemsVar] || '';
                const problemCount = problems ? problems.split(',').length : 0;
                userList += `- **${user}**: ${problemCount}ê°œ ë¬¸ì œ\n`;
              }
            } else {
              userList = '- ì•„ì§ ì œì¶œëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.\n';
            }
            
            const comment = `## ðŸ“ README ìžë™ ì—…ë°ì´íŠ¸ ì™„ë£Œ!
            
            **â° ì—…ë°ì´íŠ¸ ì‹œê°„**: ${new Date().toLocaleString('ko-KR', {timeZone: 'Asia/Seoul'})} KST
            **ðŸŽ¯ íšŒì°¨**: ${sessionNumber}íšŒì°¨
            **ðŸ“… ê¸°ê°„**: ${weekStart} ~ ${weekEnd}
            **â° ë§ˆê°**: ${deadline}
            **ðŸ‘¥ ì°¸ê°€ìž**: ${userCount}ëª…
            
            ### ðŸ“Š ë°˜ì˜ëœ ì œì¶œ í˜„í™©
            ${userList}
            
            ### ðŸ”§ ìˆ˜í–‰ëœ ìž‘ì—…
            âœ… **main ë¸Œëžœì¹˜ ìŠ¤ìº”**: ìµœì‹  ì œì¶œ í˜„í™© í™•ì¸
            âœ… **README ì—…ë°ì´íŠ¸**: ì‹¤ì œ ë°ì´í„°ë¡œ í…Œì´ë¸” êµ¬ì„±
            âœ… **PR ë¸Œëžœì¹˜ ì»¤ë°‹**: main ë¸Œëžœì¹˜ëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ
            âœ… **ì œì¶œ í˜„í™© ë°˜ì˜**: ì‚¬ìš©ìžë³„ ë¬¸ì œ ìˆ˜ ìžë™ ê³„ì‚°
            
            ### ðŸ“ ì—…ë°ì´íŠ¸ ìœ„ì¹˜
            - **ëŒ€ìƒ ë¸Œëžœì¹˜**: \`${{ github.event.pull_request.head.ref }}\` (PR ë¸Œëžœì¹˜)
            - **ê¸°ì¤€ ë°ì´í„°**: \`main\` ë¸Œëžœì¹˜ì˜ ìµœì‹  ì œì¶œ í˜„í™©
            - **ì—…ë°ì´íŠ¸ íŒŒì¼**: \`README.md\`
            
            > ðŸ’¡ **ì°¸ê³ **: main ë¸Œëžœì¹˜ëŠ” ë³€ê²½ë˜ì§€ ì•Šì•˜ìœ¼ë©°, ì´ PR ë¸Œëžœì¹˜ì—ì„œë§Œ READMEê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.
            > 
            > ðŸ“ **í™•ì¸**: ì´ PRì˜ Files changed íƒ­ì—ì„œ ì—…ë°ì´íŠ¸ëœ READMEë¥¼ í™•ì¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
            
            ---
            *ðŸ¤– PR ë¸Œëžœì¹˜ README ìžë™ ì—…ë°ì´íŠ¸ ì™„ë£Œ*`;
            
            github.rest.issues.createComment({
              issue_number: prNumber,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });
            
      - name: Final summary
        if: always()
        run: |
          echo "## ðŸ“ PR ë¸Œëžœì¹˜ README ì—…ë°ì´íŠ¸ ì™„ë£Œ!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**âœ… ì•ˆì „**: main ë¸Œëžœì¹˜ëŠ” ê±´ë“œë¦¬ì§€ ì•Šê³  PR ë¸Œëžœì¹˜ë§Œ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**ì‹¤í–‰ ì‹œê°„**: $(date '+%Y-%m-%d %H:%M:%S KST')" >> $GITHUB_STEP_SUMMARY
          echo "**íŠ¸ë¦¬ê±°**: ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            echo "**PR ë²ˆí˜¸**: #${{ github.event.number }}" >> $GITHUB_STEP_SUMMARY
            echo "**PR ë¸Œëžœì¹˜**: ${{ github.event.pull_request.head.ref }}" >> $GITHUB_STEP_SUMMARY
            echo "**ê¸°ë³¸ ë¸Œëžœì¹˜**: ${{ github.event.pull_request.base.ref }}" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“Š ì—…ë°ì´íŠ¸ ê²°ê³¼" >> $GITHUB_STEP_SUMMARY
          echo "- **íšŒì°¨**: ${SESSION_NUMBER}íšŒì°¨" >> $GITHUB_STEP_SUMMARY
          echo "- **ê¸°ê°„**: ${WEEK_START} ~ ${WEEK_END}" >> $GITHUB_STEP_SUMMARY
          echo "- **ë§ˆê°**: ${DEADLINE}" >> $GITHUB_STEP_SUMMARY
          echo "- **README ì»¤ë°‹**: ${CHANGES_COMMITTED}" >> $GITHUB_STEP_SUMMARY
          
          if [ -n "$ALL_USERS" ]; then
            USER_COUNT=$(echo "$ALL_USERS" | wc -w)
            echo "- **ì°¸ê°€ìž**: ${USER_COUNT}ëª…" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ðŸ‘¥ ìŠ¤ìº”ëœ ì°¸ê°€ìž" >> $GITHUB_STEP_SUMMARY
            for USER in $ALL_USERS; do
              PROBLEMS_VAR="USER_${USER}_PROBLEMS"
              PROBLEMS=${!PROBLEMS_VAR}
              PROBLEM_COUNT=$(echo "$PROBLEMS" | tr ',' '\n' | wc -l)
              echo "- **$USER**: $PROBLEM_COUNTê°œ ë¬¸ì œ" >> $GITHUB_STEP_SUMMARY
            done
          else
            echo "- **ì°¸ê°€ìž**: 0ëª… (ì œì¶œëœ ë¬¸ì œ ì—†ìŒ)" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸŽ¯ ìˆ˜í–‰ëœ ìž‘ì—…" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **PR ë¸Œëžœì¹˜ ì²´í¬ì•„ì›ƒ**: main ë¸Œëžœì¹˜ ê±´ë“œë¦¬ì§€ ì•ŠìŒ" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **main ë¸Œëžœì¹˜ ìŠ¤ìº”**: ìµœì‹  ì œì¶œ í˜„í™© í™•ì¸" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **README ìƒì„±**: ì‹¤ì œ ë°ì´í„°ë¡œ í…Œì´ë¸” êµ¬ì„±" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **PR ë¸Œëžœì¹˜ ì»¤ë°‹**: ì•ˆì „í•œ ë¸Œëžœì¹˜ë³„ ì—…ë°ì´íŠ¸" >> $GITHUB_STEP_SUMMARY
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "*ðŸ“ PR ë¸Œëžœì¹˜ ì „ìš© README ì—…ë°ì´íŠ¸ (main ë¸Œëžœì¹˜ ì•ˆì „)*" >> $GITHUB_STEP_SUMMARY