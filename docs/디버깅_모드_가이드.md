# 🐛 디버깅 모드 사용 가이드

## 🎯 개요

개인별 알림 시스템을 테스트하고 디버깅할 수 있도록 특별한 디버깅 모드를 제공합니다.

## 🔧 현재 디버깅 모드 설정

### GitHub Actions 설정

- **실행 주기**: 1분마다 (`"* * * * *"`)
- **DEBUG_MODE**: `"true"` 활성화
- **메시지 타입**: 금요일 오전, 일요일 오전, 일요일 저녁 3가지 모두 테스트

### 디버깅 모드 동작

1. **자동 실행**: 1분마다 GitHub Actions가 실행됩니다
2. **대상 확인**: 주간 5문제 미만인 사용자만 알림 대상
3. **메시지 발송**: 각 대상자에게 3가지 메시지 타입을 모두 발송
   - 🟡 금요일 오전: "아직 주말이 남았습니다! 화이팅!"
   - 🟠 일요일 오전: "마감일입니다! 하루가 남았어요!"
   - 🔴 일요일 저녁: "마감 임박! 지금이라도 시작하면 됩니다!"
4. **간격 조절**: 각 메시지 간 2초 대기 (API 제한 방지)
5. **전체 요약**: 기본 채널에 디버깅 결과 요약 발송

## 📱 테스트 확인 방법

### 1. GitHub Actions 로그 확인

```
Repository → Actions → "BOJ Study Automation" → 최신 실행
```

### 2. Mattermost 알림 확인

- **개인 DM**: 각 메시지 타입별로 3개씩 수신
- **기본 채널**: 디버깅 모드 실행 완료 요약 수신

### 3. 로그 메시지 확인

```
🤖 주간 문제 해결 현황 체크 및 개인 알림 시작... (디버깅 모드)
⏰ 알림 타입: debug_all
🧪 [금요일 오전] 메시지 타입 테스트 중...
🧪 [일요일 오전] 메시지 타입 테스트 중...
🧪 [일요일 저녁] 메시지 타입 테스트 중...
✅ 디버깅 모드 알림 성공: X/Y건
```

## 🏃‍♂️ 로컬 테스트 방법

### 환경변수 설정

```bash
export GITHUB_TOKEN="your_token"
export GITHUB_REPOSITORY="your_repo"
export DEBUG_MODE="true"
export yeomin4242_MATTERMOST_URL="your_webhook_url"
```

### 스크립트 실행

```bash
# 직접 실행
python scripts/deadline_checker.py

# 또는 테스트 스크립트 사용
python scripts/test_personal_notifications.py
```

## 🔄 실제 운영 모드로 전환

### ⚠️ 중요: 디버깅 완료 후 반드시 설정 변경!

#### 1. GitHub Actions 워크플로우 수정

```yaml
# .github/workflows/boj-automation.yaml

schedule:
  # 실제 운영용
  - cron: "0 0 * * 5" # 금요일 오전 9시 KST (UTC 0시)
  - cron: "0 0 * * 0" # 일요일 오전 9시 KST (UTC 0시)
  - cron: "0 12 * * 0" # 일요일 오후 9시 KST (UTC 12시)
  # 디버깅용 (주석 처리)
  # - cron: "* * * * *"
```

#### 2. DEBUG_MODE 환경변수 제거 또는 변경

```yaml
env:
  MATTERMOST_WEBHOOK_URL: ${{ secrets.MATTERMOST_WEBHOOK_URL }}
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  # DEBUG_MODE: "true"  # 이 줄을 주석 처리하거나 삭제
  yeomin4242_MATTERMOST_URL: ${{ secrets.yeomin4242_MATTERMOST_URL }}
```

## 📊 디버깅 결과 분석

### 성공 케이스

- ✅ 개인 webhook으로 3가지 메시지 모두 수신
- ✅ 메시지 내용이 시나리오별로 적절히 구성됨
- ✅ 기본 채널에 전체 요약 수신

### 실패 케이스와 해결방법

#### 알림이 오지 않는 경우

1. **환경변수 확인**: `yeomin4242_MATTERMOST_URL` 설정 여부
2. **Webhook URL 확인**: Mattermost에서 URL 재생성
3. **GitHub Secrets 확인**: Repository Settings에서 올바른 설정

#### 메시지가 일부만 오는 경우

1. **API 제한**: 메시지 간 간격 늘리기 (현재 2초)
2. **네트워크 오류**: GitHub Actions 로그에서 에러 확인

#### 문제 카운팅이 잘못된 경우

1. **디렉토리 구조**: `yeomin4242/문제번호/Main.java` 형식 확인
2. **최근 PR**: 최근 1주일 내 병합된 PR이 있는지 확인

## 🚨 주의사항

### 디버깅 모드 사용 시

- **비용**: 1분마다 실행되므로 GitHub Actions 사용량 증가
- **스팸**: 참가자들이 많은 테스트 메시지를 받게 됨
- **API 제한**: GitHub API rate limit 주의

### 실제 운영 전환 시

- **반드시**: cron schedule을 실제 시간으로 변경
- **반드시**: DEBUG_MODE 비활성화
- **확인**: 첫 실제 실행 시 로그 모니터링

## 💡 팁

### 효율적인 디버깅

1. **단계별 테스트**: 로컬 → GitHub Actions → 실제 시간대
2. **로그 분석**: 각 단계별 성공/실패 원인 파악
3. **점진적 확장**: 1명 테스트 후 → 다중 참가자 확장

### 운영 모니터링

1. **첫 주 집중 모니터링**: 실제 시간대 동작 확인
2. **성공률 추적**: 개인 알림 발송 성공률 모니터링
3. **피드백 수집**: 참가자들의 알림 수신 상황 확인

---

## 🔧 빠른 전환 체크리스트

### 디버깅 → 운영 모드

- [ ] cron schedule 변경 (`* * * * *` → 실제 시간)
- [ ] `DEBUG_MODE: "true"` 주석 처리 또는 삭제
- [ ] 변경사항 커밋 및 푸시
- [ ] 다음 실행 시간까지 대기 후 로그 확인

### 운영 → 디버깅 모드

- [ ] cron schedule을 `"* * * * *"`로 변경
- [ ] `DEBUG_MODE: "true"` 추가
- [ ] 변경사항 커밋 및 푸시
- [ ] 1분 후 첫 실행 확인

---

_디버깅이 완료되면 반드시 실제 운영 모드로 전환하여 참가자들에게 불필요한 알림이 가지 않도록 주의하세요! 🚨_
