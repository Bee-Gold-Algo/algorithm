# 📱 개인별 알림 시스템 설정 가이드

## 🎯 개요

BOJ 스터디에서 주간 문제 해결 현황을 개인별로 체크하고, 5개 미만일 경우 개인 DM으로 알림을 보내는 시스템입니다.

## ⏰ 알림 시간

- **금요일 오전 9시**: 주간 중간 체크
- **일요일 오전 9시**: 마감일 당일 알림
- **일요일 오후 9시**: 마감 임박 긴급 알림

## 🔧 설정 방법

### 1. Mattermost 개인 DM Webhook 생성

1. Mattermost에서 본인과의 DM 채널로 이동
2. 채널 설정 → Integrations → Incoming Webhooks
3. "Add Incoming Webhook" 클릭
4. 다음 설정 적용:
   - **Display Name**: `Algorithm Study Bot`
   - **Description**: `개인 알고리즘 스터디 알림`
   - **Channel**: 본인과의 DM 채널 선택
5. Webhook URL 복사 (예: `https://your-mattermost.com/hooks/xxx`)

### 2. GitHub Repository Secrets 설정

1. GitHub Repository → Settings → Secrets and variables → Actions
2. "New repository secret" 클릭
3. **Name**: `{본인GitHub아이디}_MATTERMOST_URL`
   - 예시: `yeomin4242_MATTERMOST_URL`
4. **Secret**: 위에서 복사한 Webhook URL 입력
5. "Add secret" 클릭

### 3. 설정 확인

```bash
# Repository에 본인 디렉토리가 있는지 확인
ls -la
# 결과에 본인 GitHub 아이디 디렉토리가 있어야 함

# 예시 디렉토리 구조
yeomin4242/
├── 1000/
│   └── Main.java
├── 1001/
│   └── Main.java
└── 2557/
    └── Main.java
```

## 📊 알림 동작 방식

### 주간 문제 카운팅 로직

- **기준**: 최근 1주일간 병합된 PR
- **파일 패턴**: `{username}/{문제번호}/Main.java`
- **카운팅**: 추가(added) 또는 수정(modified)된 파일만 계산

### 알림 발송 조건

- **5개 이상**: 축하 메시지 + 격려
- **5개 미만**: 부족한 문제 수 + 시간대별 맞춤 메시지

### 시간대별 메시지 차이

- **금요일 오전**: "아직 주말이 남았습니다! 화이팅!"
- **일요일 오전**: "마감일입니다! 하루가 남았어요!"
- **일요일 저녁**: "마감 임박! 지금이라도 시작하면 됩니다!"

## 🚨 주의사항

### Webhook 우선순위

1. **1순위**: `{USERNAME}_MATTERMOST_URL` (개인 DM)
2. **2순위**: `MATTERMOST_WEBHOOK_URL` (공통 채널)
3. **실패**: 로그에만 기록

### 환경변수 명명 규칙

- GitHub 아이디 **대소문자 정확히** 맞춰야 함
- 언더스코어(\_) 사용: `username_MATTERMOST_URL`
- 하이픈(-) 사용 불가

### 디렉토리 구조 요구사항

- 반드시 `{username}/{문제번호}/Main.java` 구조 유지
- 대소문자 구분: `Main.java` (정확히)

## 🧪 테스트 방법

### 1. 수동 테스트 스크립트 실행

```bash
# 로컬에서 테스트 (환경변수 설정 필요)
export GITHUB_TOKEN="your_token"
export GITHUB_REPOSITORY="your_repo"
export yeomin4242_MATTERMOST_URL="your_webhook_url"

python scripts/deadline_checker.py
```

### 2. GitHub Actions 수동 실행

1. Repository → Actions → "BOJ Study Automation"
2. "Run workflow" → "Run workflow" 클릭
3. 실행 결과 및 로그 확인

### 3. 실제 시간대 테스트

- 금요일 오전 8-10시 사이 자동 실행 확인
- 일요일 오전 8-10시, 저녁 8-10시 자동 실행 확인

## 📝 문제해결 가이드

### 알림이 오지 않는 경우

1. **Secrets 확인**: Repository Settings에서 환경변수 올바른지 확인
2. **Webhook URL 확인**: Mattermost에서 URL 복사 다시 확인
3. **GitHub Actions 로그 확인**: 실행 실패 원인 파악
4. **시간대 확인**: 정해진 시간대에만 알림 발송

### 문제 카운팅이 잘못된 경우

1. **디렉토리 구조 확인**: `username/문제번호/Main.java` 형식
2. **PR 병합 확인**: PR이 성공적으로 병합되었는지 확인
3. **파일 상태 확인**: 파일이 추가/수정 상태인지 확인

## 🔄 새로운 참가자 추가 방법

1. 새 참가자가 `{username}/` 디렉토리 생성
2. 개인 webhook URL 설정 (`{username}_MATTERMOST_URL`)
3. 자동으로 알림 대상에 포함됨

## 💡 추가 기능

- **전체 요약**: 기본 채널에 전체 참가자 현황 요약 발송
- **맞춤 메시지**: 시간대와 진행 상황에 따른 개인화된 메시지
- **Fallback 시스템**: 개인 webhook 없을 시 공통 채널 사용

---

_문의사항이 있으시면 GitHub Issues 또는 Mattermost 채널에서 언제든 연락주세요! 🚀_
